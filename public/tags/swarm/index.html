<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>swarm | minpeter DEV blog</title>
<meta name=keywords content>
<meta name=description content="Posts related to computer development">
<meta name=author content="minpeter">
<link rel=canonical href=http://minpeter.github.io/tags/swarm/>
<meta name=google-site-verification content="RNVL00kQq_OXnyYh9S4hgL35tPhS5wdFNf_qNiXhxS8">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<link rel=preload href=/icon.png as=image>
<link rel=icon href=http://minpeter.github.io/fav.ico>
<link rel=icon type=image/png sizes=16x16 href=http://minpeter.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=http://minpeter.github.io/fav.png>
<link rel=apple-touch-icon href=http://minpeter.github.io/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=http://minpeter.github.io/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.2">
<link rel=alternate type=application/rss+xml href=http://minpeter.github.io/tags/swarm/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6FQKWLZK1S"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-6FQKWLZK1S',{anonymize_ip:!1})}</script>
<meta property="og:title" content="swarm">
<meta property="og:description" content="Posts related to computer development">
<meta property="og:type" content="website">
<meta property="og:url" content="http://minpeter.github.io/tags/swarm/"><meta property="og:image" content="http://minpeter.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="minpeter DEV blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="http://minpeter.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="swarm">
<meta name=twitter:description content="Posts related to computer development">
</head>
<body class=list id=top>
<script>window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://minpeter.github.io/ accesskey=h title="minpeter DEV blog (Alt + H)">
<img src=/icon.png alt=logo aria-label=logo height=35>minpeter DEV blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=http://minpeter.github.io/archives/ title=📦Archives>
<span>📦Archives</span>
</a>
</li>
<li>
<a href=http://minpeter.github.io/categories/ title=🗃️Categories>
<span>🗃️Categories</span>
</a>
</li>
<li>
<a href=http://minpeter.github.io/search/ title="🔎Search (Alt + /)" accesskey=/>
<span>🔎Search</span>
</a>
</li>
<li>
<a href=http://minpeter.github.io/tags/ title=🏷️Tags>
<span>🏷️Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header>
<h1>swarm</h1>
</header>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>🕸️ stack 서비스를 외부에서 사용하기
</h2>
</header>
<section class=entry-content>
<p>기본적으로 stack에서 실행되는 서비스를 외부에 접속하기위해선 manager 노드와 연결되어야한다.
하지만 전 포스트에서 만든 echo stack은 constraints: [node.role != manager]옵션으로 매니저에서는 실행되지 않도록 설정했기 때문에 각각 컨테이너가 여러 노드에 분산되어있기때문에 전에 visualizer 서비스를 만들때와 같은 방식 또한 사용할수 없다.
따라서 클러스터 외부의 트래픽을 내부로 보내주는 프록시 서버를 구성해보겠다.
haproxy 이미지를 사용하여 외부트래픽이 nginx 컨테이너로 가도록 설정해보자.
ingress.yaml
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 version: "3" services: haproxy: image: dockercloud/haproxy networks: - test volumes: - /var/run/docker....</p>
</section>
<footer class=entry-footer><span title="2021-09-14 08:23:00 +0900 KST">September 14, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;minpeter</footer>
<a class=entry-link aria-label="post link to 🕸️ stack 서비스를 외부에서 사용하기" href=http://minpeter.github.io/posts/server/2021-09-14-stack-%EC%84%9C%EB%B9%84%EC%8A%A4%EB%A5%BC-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>🦕 docker stack visualizer
</h2>
</header>
<section class=entry-content>
<p>개요 visualizer는 2016 dockercon에서 stack기능 소개를 위해 만들어진 툴이다.
이를 이용하면 swarm모드에서 노드와 컨테이너의 분포상태를 시각적으로 볼수 있다.
실습 visualizer.yaml
1 2 3 4 5 6 7 8 9 10 11 12 13 version: "3" services: app: image: dockersamples/visualizer ports: - "9000:8080" volumes: - /var/run/docker.sock:/var/run/docker.sock deploy: mode: global placement: constraints: [node.role == manager] 컨테이너를 이용해 실습하고 있다면 docker cp명령어로 파일을 옮겨주자
1 $ docker cp visualizer.yaml manager:/visualizer....</p>
</section>
<footer class=entry-footer><span title="2021-09-13 12:05:00 +0900 KST">September 13, 2021</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;minpeter</footer>
<a class=entry-link aria-label="post link to 🦕 docker stack visualizer" href=http://minpeter.github.io/posts/server/2021-09-13-docker-stack-visualizer/></a>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=http://minpeter.github.io/>minpeter DEV blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
</body>
</html>